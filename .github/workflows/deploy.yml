name: Build and Validate for Git Deployment

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
    types: [ closed ]

jobs:
  validate:
    name: Validate Theme and Build Assets
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Validate WordPress Theme Structure
      run: |
        echo "🔍 Validating AI Portraits theme structure..."
        
        # Check required theme files
        REQUIRED_FILES=(
          "wp-content/themes/ai-portraits/functions.php"
          "wp-content/themes/ai-portraits/style.css" 
          "wp-content/themes/ai-portraits/index.php"
          "wp-content/themes/ai-portraits/single-ai_portrait.php"
        )
        
        for file in "${REQUIRED_FILES[@]}"; do
          if [ -f "$file" ]; then
            echo "✅ Found: $file"
          else
            echo "❌ Missing: $file"
            exit 1
          fi
        done
        
        echo "✅ All required theme files present"

    - name: Check Theme Functionality
      run: |
        echo "🧪 Checking theme functionality..."
        
        # Check for PHP syntax errors
        find wp-content/themes/ai-portraits -name "*.php" -exec php -l {} \; | grep -v "No syntax errors"
        
        # Validate CSS
        if command -v csslint &> /dev/null; then
          csslint wp-content/themes/ai-portraits/style.css
        fi
        
        echo "✅ Theme validation completed"

    - name: Prepare Deployment Files
      run: |
        echo "📦 Preparing files for Git deployment..."
        
        # Create deployment summary
        echo "## 🎨 AI Portraits Theme - Ready for Git Deployment" > DEPLOY_STATUS.md
        echo "" >> DEPLOY_STATUS.md
        echo "**Repository:** https://github.com/ethandede/modeaiarts" >> DEPLOY_STATUS.md
        echo "**Commit:** ${{ github.sha }}" >> DEPLOY_STATUS.md  
        echo "**Date:** $(date)" >> DEPLOY_STATUS.md
        echo "" >> DEPLOY_STATUS.md
        echo "### Theme Files Ready:" >> DEPLOY_STATUS.md
        find wp-content/themes/ai-portraits -type f -name "*.php" -o -name "*.css" -o -name "*.js" | sort >> DEPLOY_STATUS.md
        echo "" >> DEPLOY_STATUS.md
        echo "### Next Steps:" >> DEPLOY_STATUS.md
        echo "1. Pull this repository in Bluehost Git integration" >> DEPLOY_STATUS.md
        echo "2. Activate 'AI Portraits' theme in WordPress admin" >> DEPLOY_STATUS.md
        echo "3. Configure SEO and analytics settings" >> DEPLOY_STATUS.md
        
        echo "✅ Files ready for Git deployment to Bluehost"

    - name: Deployment Instructions
      run: |
        echo ""
        echo "🚀 DEPLOYMENT READY!"
        echo "==================="
        echo ""
        echo "Your AI Portraits theme is validated and ready for deployment."
        echo ""
        echo "To deploy via Bluehost Git Integration:"
        echo "1. Go to Bluehost cPanel → Git Version Control"
        echo "2. Pull from: https://github.com/ethandede/modeaiarts.git"
        echo "3. Branch: main"
        echo "4. Deploy to: public_html/wp-content/themes/ai-portraits/"
        echo "5. Activate theme in WordPress admin"
        echo ""
        echo "🎨 Your AI gallery will be live!"

    - name: Success Notification
      if: success()
      run: |
        echo "✅ Theme validation successful!"
        echo "🎯 Ready for Git deployment to modeaiarts.com"
        echo "📋 See BLUEHOST_GIT_SETUP.md for deployment instructions"